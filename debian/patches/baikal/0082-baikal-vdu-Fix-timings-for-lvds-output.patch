From 2defaad4629ba2b4df760763965ddda24d7c8f71 Mon Sep 17 00:00:00 2001
From: Vitaly Miniakhmetov <vitalii.miniakhmetov@t-platforms.ru>
Date: Wed, 7 Jul 2021 13:41:22 +0500
Subject: [PATCH 082/106] baikal-vdu: Fix timings for lvds output

---
 drivers/gpu/drm/baikal/baikal_vdu_crtc.c | 16 +++++++++++-----
 1 file changed, 11 insertions(+), 5 deletions(-)

diff --git a/drivers/gpu/drm/baikal/baikal_vdu_crtc.c b/drivers/gpu/drm/baikal/baikal_vdu_crtc.c
index f9e8be8d318e..d2b255c3dcc2 100644
--- a/drivers/gpu/drm/baikal/baikal_vdu_crtc.c
+++ b/drivers/gpu/drm/baikal/baikal_vdu_crtc.c
@@ -166,14 +166,20 @@ static void baikal_vdu_crtc_helper_mode_set_nofb(struct drm_crtc *crtc)
 		DRM_ERROR("Cannot set desired pixel clock (%lu Hz)\n", rate);
 
 	ppl = mode->hdisplay / 16;
-	if (priv->panel && priv->ep_count == 2) {
-		hsw = mode->hsync_end - mode->hsync_start;
-		hfp = mode->hsync_start - mode->hdisplay - 1;
+	if (priv->type == VDU_TYPE_LVDS) {
+		if (priv->panel && priv->ep_count == 2) {
+			hsw = mode->hsync_end - mode->hsync_start;
+			hfp = mode->hsync_start - mode->hdisplay - 1;
+		} else {
+			hsw = mode->hsync_end - mode->hsync_start - 1;
+			hfp = mode->hsync_start - mode->hdisplay;
+		}
+		hbp = mode->htotal - mode->hsync_end;
 	} else {
 		hsw = mode->hsync_end - mode->hsync_start - 1;
-		hfp = mode->hsync_start - mode->hdisplay;
+		hfp = mode->hsync_start - mode->hdisplay - 1;
+		hbp = mode->htotal - mode->hsync_end - 1;
 	}
-	hbp = mode->htotal - mode->hsync_end;
 
 	lpp = mode->vdisplay;
 	vsw = mode->vsync_end - mode->vsync_start;
-- 
2.33.0

