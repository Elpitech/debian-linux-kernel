From 2689549a2c206a7371000f4e795ff1b026f5007a Mon Sep 17 00:00:00 2001
From: Vitaly Miniakhmetov <vitaliy.miniakhmetov@elpitech.ru>
Date: Fri, 1 Oct 2021 12:52:44 +0500
Subject: [PATCH 097/106] dts: Common LVDS panel config

---
 .../dts/baikal/edelweiss-tf307-mb-s-d.dts     | 46 +----------
 .../boot/dts/baikal/elpitech-et101-mb-a1.dts  | 45 -----------
 .../boot/dts/baikal/elpitech-et101-mb-a2.dts  | 46 +----------
 arch/arm64/boot/dts/baikal/lvds-panel.dtsi    | 78 +++++++++++++++++++
 4 files changed, 80 insertions(+), 135 deletions(-)
 create mode 100644 arch/arm64/boot/dts/baikal/lvds-panel.dtsi

diff --git a/arch/arm64/boot/dts/baikal/edelweiss-tf307-mb-s-d.dts b/arch/arm64/boot/dts/baikal/edelweiss-tf307-mb-s-d.dts
index e4ffd51a4059..3f3c00b93228 100644
--- a/arch/arm64/boot/dts/baikal/edelweiss-tf307-mb-s-d.dts
+++ b/arch/arm64/boot/dts/baikal/edelweiss-tf307-mb-s-d.dts
@@ -9,39 +9,9 @@
 /dts-v1/;
 
 #include "bm-mbm.dtsi"
+#include "lvds-panel.dtsi"
 
 / {
-	panel {
-		/* In order to utilize LVDS LCD panel, make sure that
-		   status is "okay" along with &vdu0 status (see below). */
-		status = "okay";
-		compatible = "panel-lvds";
-		width-mm = <223>;
-		height-mm = <125>;
-		data-mapping = "vesa-24";
-		enable-gpios = <&porta 16 GPIO_ACTIVE_HIGH>;
-		panel-timing {
-			/* 1920x1080 @60Hz */
-			clock-frequency = <148500000>;
-			hactive = <1920>;
-			vactive = <1080>;
-			hsync-len = <44>;
-			hfront-porch = <88>;
-			hback-porch = <148>;
-			vsync-len = <5>;
-			vfront-porch = <4>;
-			vback-porch = <36>;
-		};
-		port {
-			panel0_lvds0: endpoint@0 {
-				remote-endpoint = <&vdu_lvds0_pads>;
-			};
-			panel0_lvds1: endpoint@1 {
-				remote-endpoint = <&vdu_lvds1_pads>;
-			};
-		};
-	};
-
 	sound {
 		simple-audio-card,hp-det-gpio = <&porta 29 GPIO_ACTIVE_HIGH>;
 	};
@@ -56,17 +26,3 @@ &gmac1 {
 	status = "okay";
 	snps,reset-gpios = <&porta 20 GPIO_ACTIVE_LOW>;
 };
-
-&vdu0 {
-	/* In order to utilize LVDS LCD panel, make sure that
-	   status is "okay" along with panel status (see above). */
-	status = "okay";
-	port {
-		vdu_lvds0_pads: endpoint@0 {
-			remote-endpoint = <&panel0_lvds0>;
-		};
-		vdu_lvds1_pads: endpoint@1 {
-			remote-endpoint = <&panel0_lvds1>;
-		};
-	};
-};
diff --git a/arch/arm64/boot/dts/baikal/elpitech-et101-mb-a1.dts b/arch/arm64/boot/dts/baikal/elpitech-et101-mb-a1.dts
index dc9ee6d3574f..a1aed946bdd3 100644
--- a/arch/arm64/boot/dts/baikal/elpitech-et101-mb-a1.dts
+++ b/arch/arm64/boot/dts/baikal/elpitech-et101-mb-a1.dts
@@ -11,37 +11,6 @@
 #include "bm-mbm.dtsi"
 
 / {
-	panel {
-		/* In order to utilize LVDS LCD panel, make sure that
-		   status is "okay" along with &vdu0 status (see below). */
-		status = "disabled";
-		compatible = "panel-lvds";
-		width-mm = <223>;
-		height-mm = <125>;
-		data-mapping = "vesa-24";
-		enable-gpios = <&porta 16 GPIO_ACTIVE_HIGH>;
-		panel-timing {
-			/* 1920x1080 @60Hz */
-			clock-frequency = <148500000>;
-			hactive = <1920>;
-			vactive = <1080>;
-			hsync-len = <44>;
-			hfront-porch = <88>;
-			hback-porch = <148>;
-			vsync-len = <5>;
-			vfront-porch = <4>;
-			vback-porch = <36>;
-		};
-		port {
-			panel0_lvds0: endpoint@0 {
-				remote-endpoint = <&vdu_lvds0_pads>;
-			};
-			panel0_lvds1: endpoint@1 {
-				remote-endpoint = <&vdu_lvds1_pads>;
-			};
-		};
-	};
-
 	sound {
 		simple-audio-card,hp-det-gpio = <&porta 29 GPIO_ACTIVE_HIGH>;
 	};
@@ -64,17 +33,3 @@ &gmac1 {
 &gmac1_phy {
 	compatible = "ethernet-phy-id001c.c916", "ethernet-phy-ieee802.3-c22";
 };
-
-&vdu0 {
-	/* In order to utilize LVDS LCD panel, make sure that
-	   status is "okay" along with panel status (see above). */
-	status = "okay";
-	port {
-		vdu_lvds0_pads: endpoint@0 {
-			remote-endpoint = <&panel0_lvds0>;
-		};
-		vdu_lvds1_pads: endpoint@1 {
-			remote-endpoint = <&panel0_lvds1>;
-		};
-	};
-};
diff --git a/arch/arm64/boot/dts/baikal/elpitech-et101-mb-a2.dts b/arch/arm64/boot/dts/baikal/elpitech-et101-mb-a2.dts
index 713ac71e8f7b..29d7db1e96df 100644
--- a/arch/arm64/boot/dts/baikal/elpitech-et101-mb-a2.dts
+++ b/arch/arm64/boot/dts/baikal/elpitech-et101-mb-a2.dts
@@ -9,39 +9,9 @@
 /dts-v1/;
 
 #include "bm-mbm.dtsi"
+#include "lvds-panel.dtsi"
 
 / {
-	panel {
-		/* In order to utilize LVDS LCD panel, make sure that
-		   status is "okay" along with &vdu0 status (see below). */
-		status = "okay";
-		compatible = "panel-lvds";
-		width-mm = <223>;
-		height-mm = <125>;
-		data-mapping = "vesa-24";
-		enable-gpios = <&porta 16 GPIO_ACTIVE_HIGH>;
-		panel-timing {
-			/* 1920x1080 @60Hz */
-			clock-frequency = <148500000>;
-			hactive = <1920>;
-			vactive = <1080>;
-			hsync-len = <44>;
-			hfront-porch = <88>;
-			hback-porch = <148>;
-			vsync-len = <5>;
-			vfront-porch = <4>;
-			vback-porch = <36>;
-		};
-		port {
-			panel0_lvds0: endpoint@0 {
-				remote-endpoint = <&vdu_lvds0_pads>;
-			};
-			panel0_lvds1: endpoint@1 {
-				remote-endpoint = <&vdu_lvds1_pads>;
-			};
-		};
-	};
-
 	sound {
 		simple-audio-card,hp-det-gpio = <&porta 29 GPIO_ACTIVE_HIGH>;
 	};
@@ -64,17 +34,3 @@ &gmac1 {
 &gmac1_phy {
 	compatible = "ethernet-phy-id001c.c916", "ethernet-phy-ieee802.3-c22";
 };
-
-&vdu0 {
-	/* In order to utilize LVDS LCD panel, make sure that
-	   status is "okay" along with panel status (see above). */
-	status = "okay";
-	port {
-		vdu_lvds0_pads: endpoint@0 {
-			remote-endpoint = <&panel0_lvds0>;
-		};
-		vdu_lvds1_pads: endpoint@1 {
-			remote-endpoint = <&panel0_lvds1>;
-		};
-	};
-};
diff --git a/arch/arm64/boot/dts/baikal/lvds-panel.dtsi b/arch/arm64/boot/dts/baikal/lvds-panel.dtsi
new file mode 100644
index 000000000000..c00e7250cc7d
--- /dev/null
+++ b/arch/arm64/boot/dts/baikal/lvds-panel.dtsi
@@ -0,0 +1,78 @@
+#include <dt-bindings/input/input.h>
+#include "bm-mbm.dtsi"
+
+/ {
+	panel {
+		/* In order to utilize LVDS LCD panel, make sure that
+		status is "okay" along with &vdu0 status (see below). */
+		status = "okay";
+		compatible = "panel-lvds";
+		width-mm = <223>;
+		height-mm = <125>;
+		data-mapping = "vesa-24";
+		panel-timing {
+			/* 1920x1080 @60Hz */
+			clock-frequency = <148500000>;
+			hactive = <1920>;
+			vactive = <1080>;
+			hsync-len = <44>;
+			hfront-porch = <88>;
+			hback-porch = <148>;
+			vsync-len = <5>;
+			vfront-porch = <4>;
+			vback-porch = <36>;
+		};
+		port {
+			panel0_lvds0: endpoint@0 {
+				remote-endpoint = <&vdu_lvds0_pads>;
+			};
+			panel0_lvds1: endpoint@1 {
+				remote-endpoint = <&vdu_lvds1_pads>;
+			};
+		};
+	};
+
+	buttons-backlight {
+		compatible = "gpio-keys";
+		autorepeat;
+		button-brightness-down {
+			label = "Brightness Down Button";
+			linux,code = <KEY_BRIGHTNESSDOWN>;
+			gpios = <&porta 18 GPIO_ACTIVE_LOW>;
+			debounce-interval = <50>;
+		};
+		button-brightness-up {
+			label = "Brightness Up Button";
+			linux,code = <KEY_BRIGHTNESSUP>;
+			gpios = <&porta 17 GPIO_ACTIVE_LOW>;
+			debounce-interval = <50>;
+		};
+		button-brightness-toggle {
+			label = "Brightness Toggle Button";
+			linux,code = <KEY_BRIGHTNESS_TOGGLE>;
+			gpios = <&porta 31 GPIO_ACTIVE_LOW>;
+			debounce-interval = <50>;
+		};
+	};
+};
+
+&vdu0 {
+	/* In order to utilize LVDS LCD panel, make sure that
+	status is "okay" along with panel status (see above). */
+	status = "okay";
+	enable-gpios = <&porta 16 GPIO_ACTIVE_LOW>;
+	backlight {
+		min-brightness-level = <10>;
+		default-brightness-level = <60>;
+		brightness-level-step = <2>;
+		pwm-frequency = <20000>;
+	};
+	port {
+		vdu_lvds0_pads: endpoint@0 {
+			remote-endpoint = <&panel0_lvds0>;
+		};
+		vdu_lvds1_pads: endpoint@1 {
+			remote-endpoint = <&panel0_lvds1>;
+		};
+	};
+};
-- 
2.33.0

