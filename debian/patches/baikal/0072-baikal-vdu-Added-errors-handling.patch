From e9c0f582bb7b0dbf281e9cacccb8337f64f5e317 Mon Sep 17 00:00:00 2001
From: Vitaly Miniakhmetov <vitalii.miniakhmetov@t-platforms.ru>
Date: Thu, 1 Jul 2021 19:42:12 +0500
Subject: [PATCH 072/106] baikal-vdu: Added errors handling

---
 drivers/gpu/drm/baikal/baikal_vdu_connector.c | 30 ++++++++++++++-----
 1 file changed, 23 insertions(+), 7 deletions(-)

diff --git a/drivers/gpu/drm/baikal/baikal_vdu_connector.c b/drivers/gpu/drm/baikal/baikal_vdu_connector.c
index a2b6d85c62e6..dd79233bb477 100644
--- a/drivers/gpu/drm/baikal/baikal_vdu_connector.c
+++ b/drivers/gpu/drm/baikal/baikal_vdu_connector.c
@@ -165,25 +165,41 @@ int baikal_vdu_lvds_connector_create(struct drm_device *dev)
 	struct baikal_vdu_private *priv = dev->dev_private;
 	struct drm_connector *connector = &priv->connector;
 	struct drm_encoder *encoder = &priv->encoder;
+	int ret;
 
-	drm_connector_init(dev, connector, &connector_funcs,
+	ret = drm_connector_init(dev, connector, &connector_funcs,
 			DRM_MODE_CONNECTOR_LVDS);
-
+	if (ret) {
+		dev_err(dev->dev, "drm_connector_init failed: %d\n", ret);
+		goto end;
+	}
 	drm_connector_helper_add(connector, &connector_helper_funcs);
 
-	drm_encoder_init(dev, encoder, &encoder_funcs,
+	ret = drm_encoder_init(dev, encoder, &encoder_funcs,
 			DRM_MODE_ENCODER_LVDS, NULL);
-
+	if (ret) {
+		dev_err(dev->dev, "drm_encoder_init failed: %d\n", ret);
+		goto end;
+	}
 	drm_encoder_helper_add(encoder, &baikal_vdu_lvds_helper_funcs);
 
 	encoder->crtc = &priv->crtc;
 	encoder->possible_crtcs = drm_crtc_mask(encoder->crtc);
 
-	drm_connector_attach_encoder(connector, encoder);
+	ret = drm_connector_attach_encoder(connector, encoder);
+	if (ret) {
+		dev_err(dev->dev, "drm_connector_attach_encoder failed: %d\n", ret);
+		goto end;
+	}
 
-	drm_connector_register(connector);
+	ret = drm_connector_register(connector);
+	if (ret) {
+		dev_err(dev->dev, "drm_connector_register failed: %d\n", ret);
+		goto end;
+	}
 
-	return 0;
+ end:
+	return ret;
 }
 
 static int baikal_vdu_backlight_update_status(struct backlight_device *bl_dev)
-- 
2.33.0

